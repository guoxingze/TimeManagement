{% autoescape off %}
<!DOCTYPE html>
<html>
<head>
	<title>Timer</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script src="../js/flipclock.js"></script>
	<script src="../js/knockout.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../css/flipclock.css">
	<!-- Knockout foreach binding http://knockoutjs.com/documentation/foreach-binding.html -->
	<!-- Clock: http://flipclockjs.com/ -->
</head>
<body>
<p>Hello "{{ userName }}"</p>
<!-- <p>Hello "{{ eventList }}"</p> -->

	<div class="clock" style="margin:2em;"></div>
	<div class="message"></div>
	<button onclick="setTimer(5)">testTimer</button>

<div id="confirmColorBox">

	<p>Do you want to save this tomato</p>
	<button onclick="saveTomato()">Save</button>
	<button>Cancel</button>
</div>



<div id="newEventDiv" style='margin-top:20px'>
	<input type="text" data-bind="textInput:newEventName" id="newEventName"></input>
	<button data-bind="click: addEvent, enable:newEventName().length>0">Add</button>
</div>


<table>
	<tr>
		<td>
			<div id="toDoList" class="listDiv">
				<ul data-bind="foreach: eventList" class="list" id="sortable">
				  <li class="ui-state-default">
				  	<span data-bind="text: name"></span>
				  	<input class="eventCheck" type="checkbox"/>
				  	<button data-bind="click: $parent.removeSelected">Remove</button>
				  </li>
				</ul>
			</div>
		</td>


		<td>
			<div id="toDoList" class="listDiv">
				<ul data-bind="foreach: eventList" class="list" id="sortable">
				  <li class="ui-state-default">
				  	<span data-bind="text: name"></span>
				  	<input class="eventCheck" type="checkbox"/>
				  	<button data-bind="click: $parent.removeSelected">Remove</button>
				  </li>
				</ul>
			</div>
		</td>

<!-- 		<td>
	<div id="DoneList" class="listDiv">
		<ul class="list" id="unsortable">
		  <li class="ui-state-default">Item 1</li>
		  <li class="ui-state-default">Item 2</li>
		  <li class="ui-state-default">Item 3</li>
		  <li class="ui-state-default">Item 4</li>
		  <li class="ui-state-default">Item 5</li>
		  <li class="ui-state-default">Item 6</li>
		  <li class="ui-state-default">Item 7</li>
		</ul>
	</div>
</td> -->
	</tr>

</table>


<!-- {% for event in eventList%}
<script type="text/javascript">
	// console.log({{event.name}})
	// console.log("test")
	eventListInDB.push({{event.name}});
</script>
	 <p>{{ event.name}}</p>
{% endfor %} -->


</body>
<script type="text/javascript">

var eventListInDB = {{eventList}};

window.vm = new AppViewModel();
window.vm.eventList(eventListInDB);
ko.applyBindings(vm);

for (var i = 0; i<eventListInDB.length; i++) {
	console.log("event " + i + " = " + eventListInDB[i])
	console.log("name " + i + " = " + eventListInDB[i].name)
};
console.log("eventListInDB = " + eventListInDB)

// for (var i; i >= 0; i--) {
// 	Things[i]
// };



function AppViewModel() {
    var self = this;

    self.newEventName= ko.observable("test");
    self.eventList = ko.observableArray([]);
    self.completedList = ko.observableArray([]);

    self.testFunction = function(){
    	console.log("test function 1")
    }

    self.addEvent = function() {
    	var newEventName = $("#newEventName").val();
        saveNewEvent(newEventName);
        self.eventList.push({ name: newEventName });
        // $("#newEventName").val('');
        self.newEventName("");
    };

    self.removeSelected = function(input) {
    	self.eventList.remove(input)
    	deleteNewEvent(input['name'])
    };

    console.log("size of newEventName = " + newEventName.length);
}


// ko.applyBindings(new AppViewModel());


	var clock;
	$(document).ready(function() {

	$("#sortable" ).sortable();
    $("#sortable" ).disableSelection();

	console.log("Test");
		clock = $('.clock').FlipClock(0, {
	        clockFace: 'MinuteCounter',
	        countdown: true,
	        callbacks: {
	        	stop: function() {
	        		// $('.message').html('The clock has stopped!');
	        		completeTomato("testeventname");
	        		window.vm.testFunction();
	        	}
	        }
	    });

	});

	function setTimer(time){
		 clock.setTime(time);
		 clock.start();
	}

	function completeTomato(completedTomato){
		$('#confirmColorBox').show();
		// alert("test")

		console.log("enter completeTomato");
		$.ajax({
		  type: "POST",
		  url: "../api/complete",
		  dataType: 'json',
		  data: JSON.stringify({ "eventName": completedTomato})
		})
		.done(function( data ) { // check why I use done
		    console.log( "event added");
		    // $('.voteCount').text(data['story']['vote_count']);
		});
	}

	function saveNewEvent(newEventName){
		console.log("enter ajax test");
		$.ajax({
		  type: "POST",
		  url: "../api/save",
		  dataType: 'json',
		  data: JSON.stringify({ "eventName": newEventName})
		})
		.done(function( data ) { // check why I use done
		    console.log( "event added");
		    // $('.voteCount').text(data['story']['vote_count']);
		});
	}

	function deleteNewEvent(eventName){
		console.log("enter ajax test");
		console.log("deleted eventName = " + eventName);
		$.ajax({
		  type: "POST",
		  url: "../api/delete",
		  dataType: 'json',
		  data: JSON.stringify({ "eventName": eventName})
		})
		.done(function( data ) { // check why I use done
		    console.log( "event deleted");
		    // $('.voteCount').text(data['story']['vote_count']);
		});
	}

	function saveTomato(){
		console.log('test 2')
	}
</script>
</html>
{% endautoescape %}


<style>
  .list { list-style-type: none; margin: 0; padding: 0; width: 100%; }
  .list li { margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px; }
  .list li span { position: absolute; margin-left: -1.3em; }

  .listDiv{
  	width: 500px;
  	background-color: #f4f4f4;
  	padding:10px;
  }

  .eventCheck{
  	margin-left:300px;
  }
</style>
